#include <idc.idc>

static main() {

    Wait();
    auto file = "/media/pwd/Elements1/dataset/train/asm/"+ GetInputFile() + ".asm";
    auto fp = fopen(file, "w+");

    //生成asm文件
    GenerateFile(OFILE_ASM, fp, 0, BADADDR, 0x0);
    fseek( fp, 0, SEEK_SET );
    //fprintf(fp, "%s", "");
    
    //去除asm文件ida生成的信息
    auto end = 50;
    auto cursize = 0;

    while(end) {
        auto line = readstr(fp);
        auto linelen = strlen(line);

        if(strstr(line, "; Segment type:	Pure code") != -1 || strstr(line, ".assem") != -1) {
            fseek(fp, cursize, SEEK_SET);
            writestr(fp, strfill(10, 1));
            break;
        }

        fseek(fp, cursize, SEEK_SET);
        writestr(fp, strfill(32, linelen));
        cursize = cursize + linelen;
        end = end - 1;
    }
    

    fclose(fp);

    Exit(0);
}
