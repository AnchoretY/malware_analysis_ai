import os
import re
import pandas as pd
col_names = ['filename','type','famliy_name','small_family_name','file_path']
df = pd.DataFrame([],columns=col_names)

mal_type_l = ["勒索","木马","蠕虫","感染型","挖矿"]
# mal_type_l = ["挖矿"]

def check_filename(filename):
    """
        检测文件名是否为标准的md5
    """
    sample = re.compile(r'[0-9A-Fa-f]{32}$')
    if sample.match(filename):
        return True
    return False

file_path_no_type = "/Volumes/Elements/AI_Samples/"
for mal_type in mal_type_l:
    file_path = os.path.join(file_path_no_type,mal_type)
    tmp = []
    famliy_l = os.listdir(file_path)
    for famliy_name in famliy_l:
        file_path_with_famliy = os.path.join(file_path,famliy_name)
        small_family_l = os.listdir(file_path_with_famliy)
        for small_family in small_family_l:
            file_path_complete = os.path.join(file_path_with_famliy,small_family)
            if os.path.isdir(file_path_complete):
                filename_l = os.listdir(file_path_complete)
                for filename in filename_l:
                    if check_filename(filename):
                        tmp.append([filename,mal_type,famliy_name,small_family,file_path_complete])
            else:
                if check_filename(small_family):
                    tmp.append([small_family,mal_type,famliy_name,"",file_path_with_famliy])
    df = pd.concat([df,pd.DataFrame(tmp,columns=col_names)])
    print("{}:".format(mal_type))
    print(df[df['type']==mal_type]['famliy_name'].value_counts())
    df.to_csv("dataLabel.csv",index=False)



print(df.head())



